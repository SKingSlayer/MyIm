<html>
<div>
    <button onclick="doGroupMsg1()"></button>
</div>
</html>
<script type="text/javascript">
    var userId=1;
    var groupId=1;
    window.onload=function (){
        console.log("hello")
    }
    var socket;
    if(window.WebSocket){
        socket = new WebSocket("ws://127.0.0.1:12345/ws");
        socket.onopen=function (){
            register()
        }
        socket.onmessage=function (event){
             doGroupMsg(event.data.toString());
        }
    }
    function send(message){
        if(!window.WebSocket){return;}
        socket.send(message);
    }
   function  doGroupMsg(msg) {
       let reg = new RegExp("#group", 'g');
       if (reg.test(msg)) {
           msg = msg.replace(reg, "")
           let reg3 = new RegExp("#msg2", 'g');
           if (reg3.test(msg)) {
               msg = msg.replace(reg3, "")
               doGroupMsg3(msg);
           }
       }
   }
    function register(){
        let  userId=1;
        let msg="#init"+userId;
        send(msg);
    }

    function doGroupMsg1(){
    var msg="#group#msg1"+JSON.stringify({
        userId:1,
        groupId:1,
        record:"hello world",
        timeStamp:dateFormat(new Date())
    })
        send(msg);
    }
    function doGroupMsg3(msg){
        var s=JSON.parse(msg);
        console.log(msg);
        var s1="#group#msg3"+JSON.stringify({
            userId:1,
            groupId:1,
            record:"",
            timeStamp:dateFormat(new Date())
        })
        send(s1)

    }

    function dateFormat(time){
        var date=new Date(time);
        var year=date.getFullYear();
        /* 在日期格式中，月份是从0开始的，因此要加0
         * 使用三元表达式在小于10的前面加0，以达到格式统一  如 09:11:05
         * */
        var month= date.getMonth()+1<10 ? "0"+(date.getMonth()+1) : date.getMonth()+1;
        var day=date.getDate()<10 ? "0"+date.getDate() : date.getDate();
        var hours=date.getHours()<10 ? "0"+date.getHours() : date.getHours();
        var minutes=date.getMinutes()<10 ? "0"+date.getMinutes() : date.getMinutes();
        var seconds=date.getSeconds()<10 ? "0"+date.getSeconds() : date.getSeconds();
        // 拼接
        return year+"-"+month+"-"+day+" "+hours+":"+minutes+":"+seconds;
    }
</script>